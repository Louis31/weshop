/*!
 * 进货入库
 */
Ext.onReady(function(){
	
	Ext.QuickTips.init();
	
	var SpxxObj = [
		{ name:'spid', type:'string'},
		{ name:'spname', type:'string'},
		{ name:'xinghao', type:'string'},
		{ name:'dw', type:'string'},
		{ name:'jhprice', type:'string'},
		{ name:'chprice', type:'string'},
		{ name:'minnum', type:'string'},
		{ name:'csname', type:'string'},
		{ name:'bz', type:'string'},
		{ name:'lbid', type:'int'},
		{ name:'lbname', type:'string'}
	];
	var v_spid="0", v_spname=""
	//商品数据
	var jhspStore = new Ext.data.JsonStore({
	    url: ctx+'/spxx/findPageSpxx.do',
	    root: 'root',
	    totalProperty: 'total',
	    fields: SpxxObj,
	    listeners:{beforeload:function(a){a.baseParams={start:v_start, limit:v_limit};}}
	});
	
	//评论列表
    var jhspGrid = new Ext.grid.GridPanel({
    	id:'djspGrid',
        store: jhspStore,
        cm: new Ext.grid.ColumnModel({
			defaults: {	menuDisabled : false},//禁止表头菜单
			columns:[
			     new Ext.grid.RowNumberer(),
				{header: '类别名称', width: 100, sortable:true, dataIndex: 'id'},
	            {header: '操作', width: 100, sortable:true, align:'center', dataIndex: 'spid',renderer:function(){
	            	return "<a>删除</a>";
	            }}
	            ]
        }),
        stripeRows: true, 	//行分隔符
        columnLines : true, //列分隔符
        margins:'20',
        style:'border:1px solid',
		region:'center',
        iconCls:'',
        
        bbar:[
         {text:'新增',iconCls:'btn-add',handler:function(){
        	 var search = document.getElementById("KeyWord").value;
        	 store.load({params:{search:search}});
         }}]
        ,
        listeners:{}
    });
    
	//供应商下拉数据
    var gysStore = new Ext.data.JsonStore({
		url: ctx+'/gys/findGysComb.do',
	    root: 'root',
	    totalProperty: 'total',
	    fields: ['value','text'],
	    listeners:{
	    	load:function(s){
	    		r = s.getAt(0);
	    		if(r){
	    			Ext.getCmp("gyscombo").onSelect(r, 0);
	    		}
	    	}
	    }
	});
    
	//商品类别树窗口
    var PositionTreeWindow = new Ext.Window({
		width:200,
		height:300,
		closeAction:'hide',
		layout : 'fit',
		buttonAlign : 'center',
		items : [{
			xtype:'treepanel',
			useArrows: true,
	        autoScroll:true,
	        enableDD:false,
	        containerScroll: true,
	        dataUrl: ctx+'/position/findPositionTree.do',
	        root: {
	            nodeType: 'async',
	            text: '所有类别',
	            draggable: false,
	            id: '0'
	        },
	        listeners:{
	        	click:function(n){
	        		if(n.id=="0"){
	        			PositionTreeWindow.buttons[0].setDisabled(true);
	        		}else{
	        			PositionTreeWindow.buttons[0].setDisabled(false);
		        		v_spid = n.id;
		        		v_spname = n.text;
	        		}
	        	},
	        	dblclick:function(n){
	        		if(n.id=="0"){
	        			PositionTreeWindow.buttons[0].setDisabled(true);
	        		}else{
	        			PositionTreeWindow.buttons[0].setDisabled(false);
		        		v_spid = n.id;
		        		v_spname = n.text;
		        		PositionTreeWindow.hide();
						//addForm.getForm().findField("lbid").setValue(v_lbid);
						//addForm.getForm().findField("lbname").setValue(v_lbname);
	        		}
	        	}
	        }
		}],
		listeners:{
			beforeshow:function(){
				var xy = Ext.getCmp("sptext").getPosition();
				PositionTreeWindow.setPosition(xy[0],xy[1]+25);
			},
        	show:function(){
        		this.items.get(0).getRootNode().expand();
        	}
        },
		buttons : [{
			width:60,
			text : '选择',
			disabled : true,
			handler : function() {
				PositionTreeWindow.hide();
				jhdForm.getForm().findField("sp_id").setValue(v_spid);
				jhdForm.getForm().findField("sp_name").setValue(v_spname);
			}
		}, {
			width:60,
			text : '',
			handler : function() {
				PositionTreeWindow.hide();
				v_spid = "0";
				v_spname = "";
			}
		}]
	});
	
    //  add
    //商品表单
    var addForm = new Ext.FormPanel({
		layout : 'form',
		frame:true,
		labelWidth:60,
		border : false,
		padding : '15 10 0 8',
		defaults : {
			anchor : '100%'
		},
		items:[]
	});
    
  //增加商品窗口
    var addWindow = new Ext.Window({
		title : '增加评论',
		width:"50%",
		height:200,
		closeAction:'hide',
		modal : true,
		border:false,
		resizable : false,
		layout : 'fit',
		buttonAlign : 'center',
		items : [addForm],
		buttons : [{
			text : '保存',
			handler : function() {
				
			}
		}, {
			text : '取消',
			handler : function() {
				
			}
		}]
	});
    // add
  
	//布局
    new Ext.Viewport({
		layout:'fit',
		items:[{
			frame:true,
			title:'',
			iconCls:'menu-11',
			layout:'border',
			items:[jhspGrid]
		}],
		listeners:{
			render:function(){
				
			}
		}
	});
	
 
	

});